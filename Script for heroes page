// Конфигурация
const API_BASE = "https://api.opendota.com/api";
const HERO_IMAGE_BASE = "https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/heroes/";
const ITEMS_PER_PAGE = 12;

// Глобальные переменные
let allHeroes = [];
let filteredHeroes = [];
let currentPage = 1;
let currentAttribute = 'all';
let currentSort = 'winrate-desc';
let currentSearch = '';

// Элементы DOM
let heroesGrid, loading, error, heroSearch, sortSelect, filterButtons;
let noResults, pagination, prevPageBtn, nextPageBtn, currentPageSpan, totalPagesSpan;

// Статистические элементы
let totalHeroesEl, avgWinrateEl, mostPopularEl, highestWinrateEl;

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    // Получаем элементы после загрузки HTML
    heroesGrid = document.getElementById('heroesGrid');
    loading = document.getElementById('loading');
    error = document.getElementById('error');
    heroSearch = document.getElementById('heroSearch');
    sortSelect = document.getElementById('sortSelect');
    filterButtons = document.querySelectorAll('.filter-btn');
    noResults = document.getElementById('noResults');
    pagination = document.getElementById('pagination');
    prevPageBtn = document.getElementById('prevPage');
    nextPageBtn = document.getElementById('nextPage');
    currentPageSpan = document.getElementById('currentPage');
    totalPagesSpan = document.getElementById('totalPages');
    
    // Статистика
    totalHeroesEl = document.getElementById('totalHeroes');
    avgWinrateEl = document.getElementById('avgWinrate');
    mostPopularEl = document.getElementById('mostPopular');
    highestWinrateEl = document.getElementById('highestWinrate');
    
    // Загружаем данные
    loadHeroesData();
    
    // Настройка обработчиков событий
    setupEventListeners();
});

// Настройка обработчиков событий
function setupEventListeners() {
    // Обработчик поиска
    if (heroSearch) {
        heroSearch.addEventListener('input', function() {
            currentSearch = this.value.toLowerCase();
            filterAndSortHeroes();
        });
    }
    
    // Обработчик сортировки
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            currentSort = this.value;
            filterAndSortHeroes();
        });
    }
    
    // Обработчики фильтров по атрибутам
    if (filterButtons) {
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Убираем активный класс у всех кнопок
                filterButtons.forEach(btn => btn.classList.remove('active'));
                // Добавляем активный класс текущей кнопке
                this.classList.add('active');
                
                // Получаем значение атрибута
                currentAttribute = this.getAttribute('data-attribute');
                filterAndSortHeroes();
            });
        });
    }
    
    // Обработчики пагинации
    if (prevPageBtn) {
        prevPageBtn.addEventListener('click', goToPrevPage);
    }
    
    if (nextPageBtn) {
        nextPageBtn.addEventListener('click', goToNextPage);
    }
}

// Загрузка данных о героях
async function loadHeroesData() {
    showLoading();
    
    try {
        // Попробуем загрузить данные из OpenDota API
        const heroesResponse = await fetch(`${API_BASE}/heroStats`);
        if (!heroesResponse.ok) throw new Error("Не удалось загрузить данные о героях");
        let heroesData = await heroesResponse.json();
        
        // Обрабатываем данные героев
        processHeroesData(heroesData);
        
        hideLoading();
        
    } catch (err) {
        console.error('Ошибка загрузки данных из API:', err);
        
        // Если API не работает, загружаем демо-данные
        loadDemoData();
    }
}

// Обработка данных о героях
function processHeroesData(heroesData) {
    // Добавляем демо-статистику (в реальном проекте это должно приходить из API)
    allHeroes = heroesData.map(hero => {
        // Генерируем демо-статистику
        const baseWinrate = 45 + Math.random() * 15; // 45-60%
        const basePickrate = 1 + Math.random() * 15; // 1-16%
        const baseBanrate = 0.5 + Math.random() * 10; // 0.5-10.5%
        
        // Определяем атрибут
        const primaryAttr = hero.primary_attr || 'str';
        
        // Определяем роли
        const allRoles = ['Carry', 'Support', 'Nuker', 'Disabler', 'Initiator', 'Durable', 'Escape', 'Pusher'];
        const roles = hero.roles || [];
        if (roles.length === 0) {
            const numRoles = 2 + Math.floor(Math.random() * 4); // 2-5 ролей
            for (let i = 0; i < numRoles; i++) {
                const randomRole = allRoles[Math.floor(Math.random() * allRoles.length)];
                if (!roles.includes(randomRole)) {
                    roles.push(randomRole);
                }
            }
        }
        
        return {
            id: hero.id,
            name: hero.localized_name,
            localized_name: hero.localized_name,
            primary_attr: primaryAttr,
            attack_type: hero.attack_type || 'Melee',
            roles: roles,
            icon: hero.icon || `npc_dota_hero_${hero.localized_name.toLowerCase().replace(/\s+/g, '_')}`,
            
            // Демо-статистика
            win_rate: baseWinrate.toFixed(1),
            pick_rate: basePickrate.toFixed(1),
            ban_rate: baseBanrate.toFixed(1),
            
            // Дополнительные параметры
            kda: (2 + Math.random() * 4).toFixed(2), // 2-6
            gold_per_min: (400 + Math.random() * 600).toFixed(0), // 400-1000
            xp_per_min: (500 + Math.random() * 500).toFixed(0), // 500-1000
        };
    });
    
    // Сортируем по винрейту по умолчанию
    allHeroes.sort((a, b) => parseFloat(b.win_rate) - parseFloat(a.win_rate));
    
    // Обновляем статистику
    updateStatsOverview();
    
    // Отображаем героев
    filteredHeroes = [...allHeroes];
    displayHeroes();
}

// Загрузка демо-данных (если API не работает)
function loadDemoData() {
    const demoHeroes = [
        { id: 1, localized_name: 'Anti-Mage', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape'] },
        { id: 2, localized_name: 'Axe', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Durable', 'Disabler'] },
        { id: 3, localized_name: 'Bane', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker'] },
        { id: 4, localized_name: 'Bloodseeker', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Nuker', 'Disabler'] },
        { id: 5, localized_name: 'Crystal Maiden', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker'] },
        { id: 6, localized_name: 'Drow Ranger', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Disabler'] },
        { id: 7, localized_name: 'Earthshaker', primary_attr: 'str', attack_type: 'Melee', roles: ['Support', 'Initiator', 'Disabler', 'Nuker'] },
        { id: 8, localized_name: 'Juggernaut', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Pusher', 'Escape'] },
        { id: 9, localized_name: 'Mirana', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Support', 'Escape', 'Nuker'] },
        { id: 10, localized_name: 'Morphling', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Escape', 'Durable', 'Nuker'] },
        { id: 11, localized_name: 'Shadow Fiend', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Nuker'] },
        { id: 12, localized_name: 'Phantom Lancer', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Pusher'] },
        { id: 13, localized_name: 'Puck', primary_attr: 'int', attack_type: 'Ranged', roles: ['Initiator', 'Disabler', 'Escape', 'Nuker'] },
        { id: 14, localized_name: 'Pudge', primary_attr: 'str', attack_type: 'Melee', roles: ['Disabler', 'Initiator', 'Durable'] },
        { id: 15, localized_name: 'Razor', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Durable', 'Nuker'] },
        { id: 16, localized_name: 'Sand King', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Support', 'Nuker'] },
        { id: 17, localized_name: 'Storm Spirit', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Escape', 'Nuker', 'Initiator'] },
        { id: 18, localized_name: 'Sven', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Disabler', 'Initiator', 'Durable'] },
        { id: 19, localized_name: 'Tiny', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Nuker', 'Pusher', 'Initiator'] },
        { id: 20, localized_name: 'Vengeful Spirit', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Support', 'Initiator', 'Disabler', 'Nuker'] },
        { id: 21, localized_name: 'Windranger', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Support', 'Disabler', 'Escape', 'Nuker'] },
        { id: 22, localized_name: 'Zeus', primary_attr: 'int', attack_type: 'Ranged', roles: ['Nuker'] },
        { id: 23, localized_name: 'Kunkka', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Support', 'Disabler', 'Initiator', 'Durable'] },
        { id: 25, localized_name: 'Lina', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Carry', 'Nuker', 'Disabler'] },
        { id: 26, localized_name: 'Lion', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker', 'Initiator'] },
        { id: 27, localized_name: 'Shadow Shaman', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Pusher', 'Disabler', 'Nuker'] },
        { id: 28, localized_name: 'Slardar', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Durable', 'Initiator', 'Disabler'] },
        { id: 29, localized_name: 'Tidehunter', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Durable', 'Disabler', 'Nuker'] },
        { id: 30, localized_name: 'Witch Doctor', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler'] },
        { id: 31, localized_name: 'Lich', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker'] },
        { id: 32, localized_name: 'Riki', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Disabler'] },
        { id: 33, localized_name: 'Enigma', primary_attr: 'int', attack_type: 'Ranged', roles: ['Disabler', 'Initiator', 'Pusher'] },
        { id: 34, localized_name: 'Tinker', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Pusher'] },
        { id: 35, localized_name: 'Sniper', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Nuker'] },
        { id: 36, localized_name: 'Necrophos', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Durable'] },
        { id: 37, localized_name: 'Warlock', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Initiator', 'Disabler'] },
        { id: 38, localized_name: 'Beastmaster', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Durable', 'Nuker'] },
        { id: 39, localized_name: 'Queen of Pain', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Escape'] },
        { id: 40, localized_name: 'Venomancer', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Initiator', 'Pusher'] },
        { id: 41, localized_name: 'Faceless Void', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Initiator', 'Disabler', 'Escape', 'Durable'] },
        { id: 42, localized_name: 'Wraith King', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Support', 'Durable', 'Disabler'] },
        { id: 43, localized_name: 'Death Prophet', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Pusher', 'Nuker', 'Disabler'] },
        { id: 44, localized_name: 'Phantom Assassin', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape'] },
        { id: 45, localized_name: 'Pugna', primary_attr: 'int', attack_type: 'Ranged', roles: ['Nuker', 'Pusher'] },
        { id: 46, localized_name: 'Templar Assassin', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Escape'] },
        { id: 47, localized_name: 'Viper', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Durable', 'Initiator', 'Disabler'] },
        { id: 48, localized_name: 'Luna', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Pusher'] },
        { id: 49, localized_name: 'Dragon Knight', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Pusher', 'Durable', 'Disabler', 'Initiator'] },
        { id: 50, localized_name: 'Dazzle', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker'] },
        { id: 51, localized_name: 'Clockwerk', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Durable', 'Nuker'] },
        { id: 52, localized_name: 'Leshrac', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Support', 'Nuker', 'Pusher', 'Disabler'] },
        { id: 53, localized_name: "Nature's Prophet", primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Pusher', 'Escape', 'Nuker'] },
        { id: 54, localized_name: 'Lifestealer', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Durable', 'Escape'] },
        { id: 55, localized_name: 'Dark Seer', primary_attr: 'int', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Escape'] },
        { id: 56, localized_name: 'Clinkz', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Escape'] },
        { id: 57, localized_name: 'Omniknight', primary_attr: 'str', attack_type: 'Melee', roles: ['Support', 'Durable', 'Nuker'] },
        { id: 58, localized_name: 'Enchantress', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Pusher', 'Durable', 'Disabler'] },
        { id: 59, localized_name: 'Huskar', primary_attr: 'str', attack_type: 'Ranged', roles: ['Carry', 'Durable', 'Initiator'] },
        { id: 60, localized_name: 'Night Stalker', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Initiator', 'Disabler', 'Durable', 'Nuker'] },
        { id: 61, localized_name: 'Broodmother', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Pusher', 'Escape', 'Nuker'] },
        { id: 62, localized_name: 'Bounty Hunter', primary_attr: 'agi', attack_type: 'Melee', roles: ['Escape', 'Nuker'] },
        { id: 63, localized_name: 'Weaver', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Escape'] },
        { id: 64, localized_name: 'Jakiro', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Pusher', 'Disabler'] },
        { id: 65, localized_name: 'Batrider', primary_attr: 'int', attack_type: 'Ranged', roles: ['Initiator', 'Disabler', 'Escape'] },
        { id: 66, localized_name: 'Chen', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Pusher'] },
        { id: 67, localized_name: 'Spectre', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Durable', 'Escape'] },
        { id: 68, localized_name: 'Ancient Apparition', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker'] },
        { id: 69, localized_name: 'Doom', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Disabler', 'Initiator', 'Durable', 'Nuker'] },
        { id: 70, localized_name: 'Ursa', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Durable', 'Disabler'] },
        { id: 71, localized_name: 'Spirit Breaker', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Initiator', 'Disabler', 'Durable', 'Escape'] },
        { id: 72, localized_name: 'Gyrocopter', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Disabler'] },
        { id: 73, localized_name: 'Alchemist', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Support', 'Durable', 'Disabler', 'Initiator'] },
        { id: 74, localized_name: 'Invoker', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Disabler', 'Escape', 'Pusher'] },
        { id: 75, localized_name: 'Silencer', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Support', 'Disabler', 'Initiator', 'Nuker'] },
        { id: 76, localized_name: 'Outworld Destroyer', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Disabler'] },
        { id: 77, localized_name: 'Lycan', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Pusher', 'Durable', 'Escape'] },
        { id: 78, localized_name: 'Brewmaster', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Initiator', 'Disabler', 'Durable', 'Nuker'] },
        { id: 79, localized_name: 'Shadow Demon', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Initiator', 'Nuker'] },
        { id: 80, localized_name: 'Lone Druid', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Pusher', 'Durable'] },
        { id: 81, localized_name: 'Chaos Knight', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Disabler', 'Durable', 'Pusher', 'Initiator'] },
        { id: 82, localized_name: 'Meepo', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Nuker', 'Disabler', 'Initiator', 'Pusher'] },
        { id: 83, localized_name: 'Treant Protector', primary_attr: 'str', attack_type: 'Melee', roles: ['Support', 'Initiator', 'Durable', 'Disabler', 'Escape'] },
        { id: 84, localized_name: 'Ogre Magi', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler', 'Durable', 'Initiator'] },
        { id: 85, localized_name: 'Undying', primary_attr: 'str', attack_type: 'Melee', roles: ['Support', 'Durable', 'Disabler', 'Nuker'] },
        { id: 86, localized_name: 'Rubick', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker'] },
        { id: 87, localized_name: 'Disruptor', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker', 'Initiator'] },
        { id: 88, localized_name: 'Nyx Assassin', primary_attr: 'agi', attack_type: 'Melee', roles: ['Disabler', 'Nuker', 'Initiator', 'Escape'] },
        { id: 89, localized_name: 'Naga Siren', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Support', 'Pusher', 'Disabler', 'Initiator', 'Escape'] },
        { id: 90, localized_name: 'Keeper of the Light', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler'] },
        { id: 91, localized_name: 'Io', primary_attr: 'str', attack_type: 'Ranged', roles: ['Support', 'Escape', 'Nuker'] },
        { id: 92, localized_name: 'Visage', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Durable', 'Disabler', 'Pusher'] },
        { id: 93, localized_name: 'Slark', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Disabler', 'Nuker'] },
        { id: 94, localized_name: 'Medusa', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Durable', 'Disabler', 'Nuker'] },
        { id: 95, localized_name: 'Troll Warlord', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Pusher', 'Disabler', 'Durable'] },
        { id: 96, localized_name: 'Centaur Warrunner', primary_attr: 'str', attack_type: 'Melee', roles: ['Durable', 'Initiator', 'Disabler', 'Nuker', 'Escape'] },
        { id: 97, localized_name: 'Magnus', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Nuker', 'Escape'] },
        { id: 98, localized_name: 'Timbersaw', primary_attr: 'str', attack_type: 'Melee', roles: ['Nuker', 'Durable', 'Escape'] },
        { id: 99, localized_name: 'Bristleback', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Durable', 'Initiator', 'Nuker'] },
        { id: 100, localized_name: 'Tusk', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Nuker'] },
        { id: 101, localized_name: 'Skywrath Mage', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler'] },
        { id: 102, localized_name: 'Abaddon', primary_attr: 'str', attack_type: 'Melee', roles: ['Support', 'Carry', 'Durable'] },
        { id: 103, localized_name: 'Elder Titan', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Disabler', 'Nuker', 'Durable'] },
        { id: 104, localized_name: 'Legion Commander', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Disabler', 'Initiator', 'Durable', 'Nuker'] },
        { id: 105, localized_name: 'Techies', primary_attr: 'int', attack_type: 'Ranged', roles: ['Nuker', 'Disabler'] },
        { id: 106, localized_name: 'Ember Spirit', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Nuker', 'Disabler', 'Initiator'] },
        { id: 107, localized_name: 'Earth Spirit', primary_attr: 'str', attack_type: 'Melee', roles: ['Nuker', 'Escape', 'Disabler', 'Initiator', 'Durable'] },
        { id: 108, localized_name: 'Underlord', primary_attr: 'str', attack_type: 'Melee', roles: ['Support', 'Nuker', 'Disabler', 'Durable', 'Escape'] },
        { id: 109, localized_name: 'Terrorblade', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Pusher', 'Nuker'] },
        { id: 110, localized_name: 'Phoenix', primary_attr: 'str', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Initiator', 'Escape', 'Disabler'] },
        { id: 111, localized_name: 'Oracle', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler', 'Escape'] },
        { id: 112, localized_name: 'Winter Wyvern', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Disabler', 'Nuker'] },
        { id: 113, localized_name: 'Arc Warden', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Carry', 'Escape', 'Nuker'] },
        { id: 114, localized_name: 'Monkey King', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Initiator', 'Disabler', 'Nuker'] },
        { id: 119, localized_name: 'Dark Willow', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler', 'Escape'] },
        { id: 120, localized_name: 'Pangolier', primary_attr: 'agi', attack_type: 'Melee', roles: ['Carry', 'Nuker', 'Disabler', 'Durable', 'Escape', 'Initiator'] },
        { id: 121, localized_name: 'Grimstroke', primary_attr: 'int', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler', 'Escape'] },
        { id: 123, localized_name: 'Hoodwink', primary_attr: 'agi', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Escape', 'Disabler'] },
        { id: 126, localized_name: 'Void Spirit', primary_attr: 'int', attack_type: 'Melee', roles: ['Carry', 'Escape', 'Nuker', 'Disabler'] },
        { id: 128, localized_name: 'Snapfire', primary_attr: 'str', attack_type: 'Ranged', roles: ['Support', 'Nuker', 'Disabler', 'Escape'] },
        { id: 129, localized_name: 'Mars', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Initiator', 'Disabler', 'Durable'] },
        { id: 131, localized_name: 'Dawnbreaker', primary_attr: 'str', attack_type: 'Melee', roles: ['Carry', 'Durable', 'Nuker'] },
        { id: 135, localized_name: 'Marci', primary_attr: 'universal', attack_type: 'Melee', roles: ['Support', 'Carry', 'Initiator', 'Disabler', 'Escape'] },
        { id: 136, localized_name: 'Primal Beast', primary_attr: 'str', attack_type: 'Melee', roles: ['Initiator', 'Durable', 'Disabler', 'Nuker'] },
        { id: 137, localized_name: 'Muerta', primary_attr: 'int', attack_type: 'Ranged', roles: ['Carry', 'Nuker', 'Disabler'] },
    ];
    
    // Добавляем демо-статистику
    allHeroes = demoHeroes.map(hero => {
        const baseWinrate = 45 + Math.random() * 15;
        const basePickrate = 1 + Math.random() * 15;
        const baseBanrate = 0.5 + Math.random() * 10;
        
        return {
            ...hero,
            win_rate: baseWinrate.toFixed(1),
            pick_rate: basePickrate.toFixed(1),
            ban_rate: baseBanrate.toFixed(1),
            kda: (2 + Math.random() * 4).toFixed(2),
            gold_per_min: (400 + Math.random() * 600).toFixed(0),
            xp_per_min: (500 + Math.random() * 500).toFixed(0),
        };
    });
    
    // Сортируем по винрейту по умолчанию
    allHeroes.sort((a, b) => parseFloat(b.win_rate) - parseFloat(a.win_rate));
    
    // Обновляем статистику
    updateStatsOverview();
    
    // Отображаем героев
    filteredHeroes = [...allHeroes];
    displayHeroes();
    
    hideLoading();
}

// Фильтрация и сортировка героев
function filterAndSortHeroes() {
    // Фильтрация по атрибуту
    if (currentAttribute === 'all') {
        filteredHeroes = [...allHeroes];
    } else {
        filteredHeroes = allHeroes.filter(hero => hero.primary_attr === currentAttribute);
    }
    
    // Фильтрация по поиску
    if (currentSearch.trim() !== '') {
        filteredHeroes = filteredHeroes.filter(hero => 
            hero.localized_name.toLowerCase().includes(currentSearch) ||
            hero.roles.some(role => role.toLowerCase().includes(currentSearch))
        );
    }
    
    // Сортировка
    sortHeroes();
    
    // Сброс пагинации
    currentPage = 1;
    
    // Отображение результатов
    displayHeroes();
}

// Сортировка героев
function sortHeroes() {
    switch(currentSort) {
        case 'winrate-desc':
            filteredHeroes.sort((a, b) => parseFloat(b.win_rate) - parseFloat(a.win_rate));
            break;
        case 'winrate-asc':
            filteredHeroes.sort((a, b) => parseFloat(a.win_rate) - parseFloat(b.win_rate));
            break;
        case 'pickrate-desc':
            filteredHeroes.sort((a, b) => parseFloat(b.pick_rate) - parseFloat(a.pick_rate));
            break;
        case 'pickrate-asc':
            filteredHeroes.sort((a, b) => parseFloat(a.pick_rate) - parseFloat(b.pick_rate));
            break;
        case 'name-asc':
            filteredHeroes.sort((a, b) => a.localized_name.localeCompare(b.localized_name));
            break;
        case 'name-desc':
            filteredHeroes.sort((a, b) => b.localized_name.localeCompare(a.localized_name));
            break;
    }
}

// Отображение героев с пагинацией
function displayHeroes() {
    if (!heroesGrid) return;
    
    heroesGrid.innerHTML = '';
    
    if (noResults) noResults.style.display = 'none';
    
    if (filteredHeroes.length === 0) {
        if (noResults) noResults.style.display = 'block';
        if (pagination) pagination.style.display = 'none';
        return;
    }
    
    // Рассчитываем пагинацию
    const totalPages = Math.ceil(filteredHeroes.length / ITEMS_PER_PAGE);
    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, filteredHeroes.length);
    const pageHeroes = filteredHeroes.slice(startIndex, endIndex);
    
    // Отображаем героев текущей страницы
    pageHeroes.forEach(hero => {
        const heroCard = createHeroCard(hero);
        heroesGrid.appendChild(heroCard);
    });
    
    // Обновляем пагинацию
    updatePagination(totalPages);
}

// Создание карточки героя
function createHeroCard(hero) {
    const card = document.createElement('div');
    card.className = 'hero-card';
    
    // Определяем класс для иконки в зависимости от атрибута
    const attrClass = hero.primary_attr;
    const attrNames = {
        'str': 'Сила',
        'agi': 'Ловкость',
        'int': 'Интеллект',
        'universal': 'Универсальный'
    };
    const attrColors = {
        'str': '#e53e3e',
        'agi': '#4CAF50',
        'int': '#2196F3',
        'universal': '#FF9800'
    };
    
    // Определяем класс для винрейта
    const winrate = parseFloat(hero.win_rate);
    let winrateClass = 'winrate-medium';
    if (winrate >= 52) winrateClass = 'winrate-high';
    else if (winrate <= 48) winrateClass = 'winrate-low';
    
    // Формируем HTML
    card.innerHTML = `
        <div class="hero-header">
            <img src="${HERO_IMAGE_BASE}${getHeroImageName(hero.localized_name)}" 
                 alt="${hero.localized_name}" 
                 class="hero-icon ${attrClass}"
                 onerror="this.src='https://via.placeholder.com/70x70/1a1d2b/8a94b3?text=Hero'">
            <div class="hero-name-container">
                <div class="hero-name">${hero.localized_name}</div>
                <div class="hero-attribute ${attrClass}-bg">
                    <i class="fas ${getAttrIcon(hero.primary_attr)}"></i> ${attrNames[hero.primary_attr]}
                </div>
                <div style="color: #8a94b3; font-size: 0.9rem;">
                    ${hero.attack_type === 'Melee' ? 'Ближний бой' : 'Дальний бой'}
                </div>
            </div>
        </div>
        
        <div class="hero-stats">
            <div class="stat-row">
                <span class="stat-label">Винрейт:</span>
                <span class="stat-value-hero" style="color: ${attrColors[hero.primary_attr]}">
                    ${hero.win_rate}%
                </span>
            </div>
            
            <div class="winrate-bar-container">
                <div class="winrate-label">
                    <span>0%</span>
                    <span>100%</span>
                </div>
                <div class="winrate-bar">
                    <div class="winrate-fill ${winrateClass}" style="width: ${winrate}%"></div>
                </div>
            </div>
            
            <div class="stat-row">
                <span class="stat-label">Популярность:</span>
                <span class="stat-value-hero">${hero.pick_rate}%</span>
            </div>
            
            <div class="stat-row">
                <span class="stat-label">Запреты:</span>
                <span class="stat-value-hero">${hero.ban_rate}%</span>
            </div>
            
            <div class="stat-row">
                <span class="stat-label">K/D/A:</span>
                <span class="stat-value-hero">${hero.kda}</span>
            </div>
            
            <div class="hero-roles">
                ${hero.roles.map(role => `<span class="role-tag">${role}</span>`).join('')}
            </div>
        </div>
        
        <div class="hero-meta">
            <div class="meta-item">
                <div class="meta-value">${hero.gold_per_min}</div>
                <div class="meta-label">GPM</div>
            </div>
            <div class="meta-item">
                <div class="meta-value">${hero.xp_per_min}</div>
                <div class="meta-label">XPM</div>
            </div>
            <div class="meta-item">
                <div class="meta-value">#${hero.id}</div>
                <div class="meta-label">ID героя</div>
            </div>
        </div>
    `;
    
    return card;
}

// Обновление пагинации
function updatePagination(totalPages) {
    if (!pagination) return;
    
    if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
    }
    
    pagination.style.display = 'flex';
    if (currentPageSpan) currentPageSpan.textContent = currentPage;
    if (totalPagesSpan) totalPagesSpan.textContent = totalPages;
    
    if (prevPageBtn) prevPageBtn.disabled = currentPage === 1;
    if (nextPageBtn) nextPageBtn.disabled = currentPage === totalPages;
}

// Переход на предыдущую страницу
function goToPrevPage() {
    if (currentPage > 1) {
        currentPage--;
        displayHeroes();
    }
}

// Переход на следующую страницу
function goToNextPage() {
    const totalPages = Math.ceil(filteredHeroes.length / ITEMS_PER_PAGE);
    if (currentPage < totalPages) {
        currentPage++;
        displayHeroes();
    }
}

// Обновление статистики
function updateStatsOverview() {
    if (totalHeroesEl) totalHeroesEl.textContent = allHeroes.length;
    
    // Средний винрейт
    if (avgWinrateEl) {
        const avgWinrate = allHeroes.reduce((sum, hero) => sum + parseFloat(hero.win_rate), 0) / allHeroes.length;
        avgWinrateEl.textContent = avgWinrate.toFixed(1) + '%';
    }
    
    // Самый популярный герой
    if (mostPopularEl) {
        const mostPopular = [...allHeroes].sort((a, b) => parseFloat(b.pick_rate) - parseFloat(a.pick_rate))[0];
        mostPopularEl.textContent = mostPopular.localized_name;
    }
    
    // Самый высокий винрейт
    if (highestWinrateEl) {
        const highestWinrate = [...allHeroes].sort((a, b) => parseFloat(b.win_rate) - parseFloat(a.win_rate))[0];
        highestWinrateEl.textContent = highestWinrate.win_rate + '%';
    }
}

// Вспомогательные функции
function getHeroImageName(heroName) {
    // Преобразуем имя героя для URL изображения
    return heroName.toLowerCase()
        .replace(/\s+/g, '_')
        .replace(/'/g, '')
        .replace(/\./g, '') + '.png';
}

function getAttrIcon(attr) {
    switch(attr) {
        case 'str': return 'fa-fist-raised';
        case 'agi': return 'fa-running';
        case 'int': return 'fa-brain';
        case 'universal': return 'fa-star';
        default: return 'fa-question';
    }
}

function showLoading() {
    if (loading) loading.style.display = 'block';
}

function hideLoading() {
    if (loading) loading.style.display = 'none';
}
